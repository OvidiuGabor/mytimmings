@model IEnumerable<mytimmings.Models.Portal.DayRecord>




<link href="~/fullcalendar/lib/main.css" rel="stylesheet" />
<script src="~/fullcalendar/lib/main.js"></script>
@Styles.Render("~/Portal/css")


<style>
    #external-events {
        position: fixed;
        margin-top: 60px;
        z-index: 2;
        width: 150px;
        padding: 0 10px;
        border: 1px solid #ccc;
        background: #eee;
    }

        #external-events .fc-event {
            cursor: move;
            margin: 3px 0;
        }

    #calendar-container {
        position: relative;
        z-index: 1;
        margin-left: 200px;
    }
    html{
      /*  overflow: hidden*/
    }
    .main-wrapper {
        height: 800px
    }
    .calendar-container{
        height: 100%
    }
</style>


<div class="main-body-container w3-main">
    @Html.Partial("_EventOption")
    <div class="page-title">
        <h1>Today status</h1>
    </div>
    <div class="main-wrapper">
        <div id="external-events">
            <p>
                <strong>Events</strong>
                <div class='fc-event fc-h-event fc-daygrid-event fc-daygrid-block-event'>
                    <div class='fc-event-main'>Busy</div>
                </div>
                <div class='fc-event fc-h-event fc-daygrid-event fc-daygrid-block-event'>
                    <div class='fc-event-main'>Meeting</div>
                </div>
                <div class='fc-event fc-h-event fc-daygrid-event fc-daygrid-block-event'>
                    <div class='fc-event-main'>Break</div>
                </div>
                <div class='fc-event fc-h-event fc-daygrid-event fc-daygrid-block-event'>
                    <div class='fc-event-main'>Idle</div>
                </div>
            </p>
        </div>


        <div class="calendar-container" style="margin-left:150px">
            <div id="calendar" style="margin: 15px">

            </div>
        </div>
    </div>


</div>


<script>

    var externalCalendar;

    document.addEventListener('DOMContentLoaded', function () {
        var Calendar = FullCalendar.Calendar;
        var Draggable = FullCalendar.Draggable;

        var containerEl = document.getElementById('external-events');
        var calendarEl = document.getElementById('calendar');

        var eventsList = [];

        new Draggable(containerEl, {
            itemSelector: '.fc-event',
            eventData: function (eventEl) {
                return {
                    title: eventEl.innerText
                };
            }
        });

        // initialize the calendar
        // -----------------------------------------------------------------

        var calendar = new Calendar(calendarEl, {
            headerToolbar: {
                start: "",
                center: "title",
                end: ""
            },
            initialView: 'timeGridDay',
            slotDuration: '00:10',
            nowIndicator: true,
            editable: true,
            navLinks: true,
            droppable: true, // this allows things to be dropped onto the calendar
            scrollTime: new Date().getTime(),
            slotMinTime: "07:00:00",
            slotMaxTime: "22:00:00",
            height: '100%',
            eventOverlap: false, //Do not allow for an event to overlap another event
            drop: function (info) {
                //make the checkes after an element is dropped
                //console.log(info.draggedEl)


                // is the "remove after drop" checkbox checked?
                //if (checkbox.checked) {
                //    // if so, remove the element from the "Draggable Events" list
                //    info.draggedEl.parentNode.removeChild(info.draggedEl);
                //}
            },
            businessHours: true,
            businessHours: {
                // days of week. an array of zero-based day of week integers (0=Sunday)
                daysOfWeek: [1, 2, 3, 4, 5], // Monday - Thursday

                startTime: '10:00', // a start time (10am in this example)
                endTime: '18:00', // an end time (6pm in this example)
            },
            eventReceive: function (info) {
                //Get the total number of events
                var count = getCountOfEvents()
                //When an event is received into the calendar, set the ID as an ExtendProperty.
                //It is the only way i found so that i can set an identifier to the event.
                //SetProp(id, 4) -> it is not working.

                info.event.setExtendedProp("id", count)
                info.event.setExtendedProp("comments", "")
                console.log(info)
            },
            eventClick: function (info) {
                var eventObj = info.event
                //console.log(eventObj)
                //console.log(eventObj.title)
                //console.log(eventObj.start)
                //console.log(eventObj.end)
                
                $('#modal').modal('show')
                SetModalInformation(eventObj.start, eventObj.end, "aa")
            }
        });

        calendar.render();
        externalCalendar = calendar;

        function getCountOfEvents() {
            return calendar.getEvents().length
        }

    });




    function SetModalInformation(startdate, endDate, comments) {
        var modal = document.getElementById("modal");
        console.log(modal)
        var startDate = modal.querySelector('[id=startDate]')

        //Set the fields to related information

        startDate.value = startdate
        console.log(externalCalendar.getEvents())
    }

</script>





