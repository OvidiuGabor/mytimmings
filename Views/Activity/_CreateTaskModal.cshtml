
<div id="modal-right" class="modal fade" data-backdrop="true">
    <div class="modal-dialog modal-right w-xl">
        <div class="modal-content h-100 no-radius" style="overflow: auto">
            <div class="modal-header">
                <div class="modal-title text-md">Create new Task</div> <button class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="p-4 text-center">
                    <form id="create-task">
                        <div class="form-row">
                            <div class="form-group col-md-12">
                                <label for="dateInput">Date</label>
                                <input type="date" class="form-control" id="dateInput" placeholder="Task Date" style="text-align: center">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group col-md-6">
                                <label for="starttime">Start Time</label>
                                <input type="time" class="form-control" id="startTime" placeholder="Start Time">
                            </div>
                            <div class="form-group col-md-6">
                                <label for="endTime">End Time</label>
                                <input type="time" class="form-control" id="endTime" placeholder="End Time">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group col-md-12">
                                <label for="title">Task Title</label>
                                <input type="text" class="form-control" id="title" placeholder="Title">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group col-md-12">
                                <label for="project">Project</label>
                                <select id="project" class="form-control">
                                    <option selected value="1">MyTimmings</option>
                                    <option value="0">Other</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group col-md-12">
                                <label for="status">Status</label>
                                <select id="status" class="form-control">
                                    <option selected value="On Duty">On Duty</option>
                                    <option value="Break">Break</option>
                                    <option value="Overtime">Overtime</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group col-md-12">
                                <label for="tags">Tags</label>
                                <input type="text" class="form-control" id="tags" placeholder="Tags">
                            </div>
                        </div>
                        <div class="row" id="tags-container">

                        </div>
                        <div class="form-row">
                            <div class="form-group col-md-12">
                                <label for="details">Details</label>
                                <textarea id="details" cols="55" rows="15"></textarea>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <div class="modal-footer"><button type="button" class="btn btn-light" data-dismiss="modal">Close</button> <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="submitData()">Save Details</button></div>
        </div>
    </div>
</div>



<script>
    //function for adding "#" on the begining of the input field
    (function addhashtag() {
        var tagsinput = document.getElementById("tags");
        var inputValue = "";

        //check if the element exists
        if (tagsinput) {
            inputValue = tagsinput.value;
            if (inputValue.indexOf("#") < 0) {
                tagsinput.value = "#"
            }
        }

    }())


    //function for checking the input on the textbox
    //last character is mandatory to be #
    //check for # at the beging of the word, and if there is, all character are colored with the same color and with italic so that the user know is typing a hashtag

    $("#tags").on('keydown change', function (e) {
        var inputValue = $(this).val()
        if (inputValue == "") {
            $(this).val("#")
        }
        //if the user type a # that is not at the begining of the word, we then remove it
        if (e.key == '#') {
            //console.log("you have pressed #")
            if (inputValue.charAt(0) == "#") {
                e.preventDefault();
                $(this).val(inputValue);
            } else {
                e.preventDefault();
                $(this).val("#" + inputValue)
            }
        }

        if (e.keyCode == 13) {
            AddTagToList(inputValue)
            $(this).val("#")
        }

    })

    var previousNumber = 0;
    function AddTagToList(tag) {
        //set a copy of the global colors
        //if there are no colors in the list, we then use the constant default list

        let localColors = colors
        if (localColors.length == 0)
            localColors = defaultColors;

        var container = document.getElementById("tags-container")
        let randomNumber = Math.floor(Math.random() * colors.length)

        while (previousNumber == randomNumber) {

            randomNumber = Math.floor(Math.random() * colors.length);

        }
        previousNumber = randomNumber;
        var pickedColor = colors[randomNumber]

        var backgroundColor = "rbga(167, 58, 232, 0.1)";
        var color = "rbga(167, 58, 232, 1)";

        if (pickedColor != undefined || pickedColor != "") {
            backgroundColor = pickedColor.replace(",1)", ",0.1)");
            color = pickedColor;
        }


        //container.innerHTML += "<p style= 'padding: 7px; margin: 12px; border-radius: 50px; font-size: 12px; margin-left: 0px; color: red; background-color: blue'>" + tag + "</p>"
        var element = "<p style='padding: 7px; cursor: pointer; margin: 12px; border-radius: 50px; font-size: 12px; margin-left: 0px; color: " + color + "; background-color: " + backgroundColor + "' class='tag-item' onclick='removeSelf(this)'>" + tag + "</p>"
        container.innerHTML += element

    }

    function removeSelf(self) {
        self.remove()
    }

    function submitData() {
        let formData = new FormData();
        let tags = [];
        let tagsColor = [];
        //set values of the form
        formData.append("currentDate", $("#dateInput").val());
        formData.append("startDate", $("#startTime").val());
        formData.append("endDate", $("#endTime").val());
        formData.append("status", $("#status").val());
        formData.append("projectId", $("#project").val());
        formData.append("description", $("#details").val());
        formData.append("title", $("#title").val());

        //get tags
        var tagshtml = document.getElementsByClassName("tag-item");
        for (var i = 0; i < tagshtml.length; i++) {
            var value = tagshtml[i].innerHTML;
            var color = tagshtml[i].style.backgroundColor;

            tags.push(value);
            tagsColor.push(color)
        }
        formData.append("tags", tags);
        formData.append("tagsColors", tagsColor);

        console.log(tags)
        console.log(tagsColor)

        $.ajax({
            type: "post",
            url: '@Url.Action("AddTask", "Activity")',
            contentType: false,
            processData: false,
            data: formData,
            success: function (data) {
                //console.log(data.data)
                if (data.status == "success") {

                } else if (data.status == "error") {
                    notif.error(data.message, "Error");
                }


            },
            error: function (data) {
                notif.error("Something happen! Please try again later!", "Error");
            }
        })

        console.log(formData)
    }



</script>